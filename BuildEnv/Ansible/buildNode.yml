- hosts: all
  connection: local
  vars:
    packer_version: 0.10.1
    packer_download_url: "https://releases.hashicorp.com/packer/{{ packer_version }}/packer_{{ packer_version }}_linux_amd64.zip"
    packer_archive_path: "/var/cache/packer/packer_{{ packer_version }}"
    packer_binary_path: "/usr/local/bin"
    packer_plugins: {}
    packer_force_install: False

  tasks:

  - name: check if packer is installed
    stat: path=/usr/local/bin/packer
    register: packer_bin

  - name: Install node packages
    become: yes
    apt: name={{item}} state=present
    with_items:
      - nodejs
      - nodejs-dev
      - npm
      - nodejs-legacy

  - name: trust MSFT package key
    apt_key:
      url: "https://packages.microsoft.com/keys/microsoft.asc"
      state: present
    become: yes

  - name: Add azure apt repo
    apt_repository:
      repo: deb [arch=amd64] https://packages.microsoft.com/repos/azure-cli/ wheezy main
      state: present
    become: yes
    
  - name: Install az packages
    become: yes
    apt: name={{item}} state=present allow_unauthenticated=yes
    with_items:
      - apt-transport-https
      - azure-cli

  - name: Install ruby packages
    become: yes
    apt: name={{item}} state=present
    with_items:
      - ruby

  - name: install gems
    become: yes
    shell: gem install graphql-client
    